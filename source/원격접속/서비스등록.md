#### 사용자 정의 서비스는 etc가 맞음 부팅시 에러 가능성 o
(근데 etc로 잘 안되서 그냥 lib 에 넣어놓음)

```less
# /lib/systemd/system/reversessh.service

[Unit]
Description=Reverse SSH Service
After=network.target

[Service]
Type=idle
ExecStart=/bin/sh /home/pi/reversesshservice.sh

[Install]
WantedBy=multi-user.target
```

#### 기존 enable된 파일 삭제 후 다시 설정

```less
# 기존 심볼릭 링크 제거
sudo rm /etc/systemd/system/multi-user.target.wants/reversessh.service

sudo nano /lib/systemd/system/reversessh.service

# daemon-reload로 systemd 캐시 갱신
sudo systemctl daemon-reload

# 다시 enable 실행
sudo systemctl enable reversessh.service

sudo systemctl start reversessh.service

sudo systemctl status reversessh.service
```


✅ 안될 경우

#### 1. knownhosts 제거
```less
cd ~/.ssh

sudo nano known_hosts

# 서버 재연결로 knownhosts 추가
ssh -p 2222 root@smart.apple-box.kr
```

#### 2. 로그파일 권한 부여
```less
./reversesshservice.sh 실행 해보고 오류 확인

ls -l /home/pi/reversessh.log

sudo chmod 666 /home/pi/reversessh.log
```


✅ 1. /lib/systemd/system/은 "기본 서비스 파일"이 저장되는 곳
```less
/lib/systemd/system/ 경로는 패키지 설치 시 기본 서비스 파일을 저장하는 곳

예를 들어, apt install openssh-server 하면 ssh.service가 /lib/systemd/system/에 저장됨

즉, 공식 서비스 파일은 /lib/systemd/system/에 위치해야 한다!
```


✅ 2. /etc/systemd/system/multi-user.target.wants/는 실행될 서비스 목록을 저장하는 곳
```less
systemctl enable 서비스명을 실행하면
→ /etc/systemd/system/multi-user.target.wants/에 해당 서비스의 심볼릭 링크가 생성됨

즉, 여기 있는 서비스들은 부팅 시 자동 실행됨
```

#### 네이버 서버에서 listen 확인
```less
# 원격접속
ssh -p 2222 root@smart.apple-box.kr

pw : tmshdnxmfl (스노우트리)

# listen 중인 포트 확인
netstat -tulnp | grep ssh

ss -tulnp | grep ssh
```





