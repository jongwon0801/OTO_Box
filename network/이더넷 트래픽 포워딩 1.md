#### 이더넷 트래픽
#### 이더넷 or wifi로 받은 네트워크 신호를
AP모드로 핫스팟을 킨 라즈베리파이로 접속된 디바이스가 인터넷 사용 가능하게 설정
```less
sudo systemctl is-enabled dnsmasq

sudo systemctl enable dnsmasq

# 이더넷 트래픽 포워딩
sudo nano /etc/sysctl.conf

# 주석해제
net.ipv4.ip_forward=1
```

#### 방화벽 설정 (파일 새로 만듬)
```less
sudo nano /etc/iptables-hs
```

#### 기존 보관함 세팅
```less
#!/bin/bash
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
# NAT 테이블의 POSTROUTING 체인에 규칙 추가: eth0 인터페이스로 나가는 패킷의 소스 IP를 해당 인터페이스의 IP로 변경(IP 마스커레이딩)

iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
# FORWARD 체인에 규칙 추가: eth0에서 들어와서 wlan0으로 나가는 패킷 중 이미 연결된(RELATED) 또는 설정된(ESTABLISHED) 상태의 패킷 허용

iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
# FORWARD 체인에 규칙 추가: wlan0에서 들어와서 eth0으로 나가는 모든 패킷 허용

iptables -t nat -A POSTROUTING -o vpn_soft -j MASQUERADE
# NAT 테이블의 POSTROUTING 체인에 규칙 추가: vpn_soft 인터페이스로 나가는 패킷의 소스 IP를 해당 인터페이스의 IP로 변경(VPN 트래픽 마스커레이딩)

#iptables -A INPUT -s server -j ACCEPT
# (주석 처리됨) INPUT 체인에 규칙 추가: 'server'에서 오는 모든 입력 패킷 허용

#iptables -A OUTPUT -d server -j ACCEPT
# (주석 처리됨) OUTPUT 체인에 규칙 추가: 'server'로 가는 모든 출력 패킷 허용

#iptables -A OUTPUT -o eth0 -j DROP
# (주석 처리됨) OUTPUT 체인에 규칙 추가: eth0 인터페이스로 나가는 모든 패킷 차단

#iptables -A INPUT -i eth0 -j DROP
# (주석 처리됨) INPUT 체인에 규칙 추가: eth0 인터페이스로 들어오는 모든 패킷 차단
```

#### 신규 보관함 세팅
```less
#!/bin/bash
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT

# 서버와의 통신만 허용함 (LTE라우터의 경우)
#iptables -A INPUT -s 125.209.200.159 -j ACCEPT
#iptables -A OUTPUT -d 125.209.200.159 -j ACCEPT
#iptables -A OUTPUT -o eth0 -j DROP
#iptables -A INPUT -i eth0 -j DROP
```

#### 실행권한 설정
```less
sudo chmod +x /etc/iptables-hs
```

#### 재부팅 시 자동 실행 설정
```less
[Unit]
Description=Activate IPtables for Hotspot
After=network-pre.target
Before=network-online.target

[Service]
Type=simple
ExecStart=/etc/iptables-hs

[Install]
WantedBy=multi-user.target
```

#### 서비스 실행
```less
sudo systemctl enable hs-iptables.service

sudo reboot
```






