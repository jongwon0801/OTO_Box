
#### 1. SSH 클라이언트와 서버 설치 확인
```less
대부분의 리눅스 시스템에는 이미 ssh 클라이언트와 sshd 서버가 기본적으로 설치됨

공개키 인증을 설정 하기 위해 SSH 서버와 클라이언트가 필요, 주로 sshd (SSH 데몬)와 ssh 클라이언트가 포함되어 있습니다.
```
```less
# 클라이언트 확인
ssh -V

# 서버 설치 상태를 확인
sudo systemctl status ssh
```

만약 설치되어 있지 않다면, 다음 명령어로 설치

```less
# Ubuntu/Debian 계열
sudo apt update
sudo apt install openssh-client openssh-server

# CentOS/RHEL 계열
sudo yum install openssh-clients openssh-server
```

#### 2. SSH 키 생성
- SSH 키를 생성하려면 클라이언트 측에서 ssh-keygen 명령어를 사용. 이 명령어는 비공개키와 공개키 쌍을 생성
```
ssh-keygen -t rsa -b 2048
```
- -t rsa: RSA 알고리즘을 사용하여 키 생성.
- -b 2048: 2048 비트 키 길이를 지정.

```
# 실행결과
Enter file in which to save the key (/home/pi/.ssh/id_rsa):
```

여기서 경로를 기본값으로 두고 Enter 누르면
비공개키(id_rsa)와 공개키(id_rsa.pub)가 ~/.ssh/ 디렉토리에 생성됨


#### 3. 공개키를 서버에 등록

공개키를 서버의 authorized_keys 파일에 추가

공개키 복사: id_rsa.pub 파일에 있는 공개키를 서버의 ~/.ssh/authorized_keys 파일에 추가해야 합니다.

이를 위해 ssh-copy-id 명령어를 사용할 수 있습니다.
```less
ssh-copy-id -i ~/.ssh/id_rsa.pub -p 2222 root@smart.apple-box.kr
```

이 명령어는 자동으로 공개키를 서버의 authorized_keys에 추가합니다.

만약 ssh-copy-id가 설치되지 않았다면, 다음과 같이 수동으로 할 수 있습니다


3-1. 클라이언트에서 공개키 내용(id_rsa.pub)을 확인합니다

```less
cat ~/.ssh/id_rsa.pub
```

3-2. 서버에 접속하여 ~/.ssh/authorized_keys 파일에 공개키를 추가합니다

```less
ssh -p 2222 root@smart.apple-box.kr
mkdir -p ~/.ssh
echo "클라이언트 공개키 내용" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```
authorized_keys 파일은 서버에 접속할 수 있는 공개키 목록을 관리하는 파일입니다.
각 공개키는 한 줄에 하나씩 추가됩니다.


#### 4. 서버에서 공개키 인증 설정
SSH 서버에서 공개키 인증을 사용하도록 설정을 확인하거나 변경해야 할 수 있습니다.

sshd_config 파일을 열고, 다음 항목들이 활성화되어 있는지 확인

```less
sudo nano /etc/ssh/sshd_config
```

- PubkeyAuthentication yes (공개키 인증을 사용하도록 설정)
- AuthorizedKeysFile .ssh/authorized_keys (기본 경로 설정)


변경 후, SSH 서버를 다시 시작하여 설정을 적용합니다
```less
sudo systemctl restart ssh
```
```less
sshd_config의 PubkeyAuthentication, AuthorizedKeysFile 설정이 주석 상태여도

SSH 서버에서 공개키 인증(PubkeyAuthentication)은 기본적으로 허용 상태로 설정되어 있음

AuthorizedKeysFile과 같은 경로 설정도 기본값을 사용하면 sshd_config 수정 안해도 비밀번호 없이 공개키로 접속가능
```


